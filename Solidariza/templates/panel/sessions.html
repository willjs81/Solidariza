{% extends "base.html" %}
{% load panel_extras %}
{% block content %}
<section class="section">
  <div class="container">
    <div class="level">
      <div class="level-left">
        <h1 class="title is-4">Sessões</h1>
      </div>
      <div class="level-right">
        <form method="get" class="field has-addons">
          <div class="control"><div class="select is-small">
            <select name="range">
              <option value="5" {% if range == '5' %}selected{% endif %}>Últimos 5 min</option>
              <option value="15" {% if range == '15' %}selected{% endif %}>Últimos 15 min</option>
              <option value="30" {% if range == '30' %}selected{% endif %}>Últimos 30 min</option>
              <option value="all" {% if range == 'all' %}selected{% endif %}>Todas (inclui inativas)</option>
            </select>
          </div></div>
          <div class="control"><button class="button is-small is-link" type="submit">Filtrar</button></div>
        </form>
      </div>
    </div>
    <table class="table is-fullwidth is-striped">
      <thead>
        <tr>
          <th>Usuário</th>
          <th>Organização</th>
          <th>IP</th>
          <th>User-Agent</th>
          <th>Última atividade</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for s in sessions %}
        <tr>
          <td>{{ s.user.get_full_name|default:s.user.username }}</td>
          <td>{{ s.organization.name|default:"Toda a Rede" }}</td>
          <td>{{ s.ip_address }}</td>
          <td style="max-width: 420px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ s.user_agent }}">{{ s.user_agent }}</td>
          <td>{{ s.last_seen|date:"d/m/Y H:i:s" }}</td>
          <td>
            <form method="post" action="{% url 'panel:session_terminate' %}">
              {% csrf_token %}
              <input type="hidden" name="session_key" value="{{ s.session_key }}" />
              <button class="button is-small is-danger" onclick="return confirm('Encerrar esta sessão?');">Encerrar</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Nenhuma sessão ativa no momento.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
