{% extends "base.html" %}
{% block content %}
<section class="section">
  <div class="container">
    <div class="level">
      <div class="level-left">
        <h1 class="title is-4">Auditoria de ações</h1>
      </div>
      <div class="level-right">
        <form method="get" class="field is-grouped">
          <div class="control">
            <div class="select is-small">
              <select name="organization">
                <option value="">Todas as organizações</option>
                {% for o in organizations %}
                  <option value="{{ o.id }}" {% if organization == o.id|stringformat:'s' %}selected{% endif %}>{{ o.name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="control">
            <input class="input is-small" type="date" name="start" value="{{ start }}" placeholder="Início">
          </div>
          <div class="control">
            <input class="input is-small" type="date" name="end" value="{{ end }}" placeholder="Fim">
          </div>
          <div class="control">
            <button class="button is-small is-link" type="submit">Filtrar</button>
          </div>
        </form>
      </div>
    </div>
    <table class="table is-fullwidth is-striped">
      <thead>
        <tr>
          <th>Quando</th>
          <th>Usuário</th>
          <th>Organização</th>
          <th>Ação</th>
          <th>Alvo</th>
          <th>Descrição</th>
          <th>IP</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.created_at|date:"d/m/Y H:i:s" }}</td>
          <td>{{ log.user.get_full_name|default:log.user.username }}</td>
          <td>{{ log.organization.name|default:"" }}</td>
          <td>{{ log.action }}</td>
          <td>{{ log.model_name }} {{ log.object_id }}</td>
          <td>{{ log.description }}</td>
          <td>{{ log.ip_address }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="7">Sem registros.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
